

@{Layout = null;}

<style type="text/css">
    .btn.disabled { background-color: #d9d8d8 !important; color: #666 !important; }
</style>

<script type="text/javascript">
    var SmsMethod = {
        timer: "",
        countCofig: 120,
        curCount: 120
    };
    SmsMethod.postSms = function (id, btn, code) {
        var phone = $("#" + id).val();
        var txtCode = $("#" + code).val();
        if ($.trim(phone) == "") {
            layer.alert("请输入手机号码!");
            return false;
        }
        if ($.trim(txtCode) == "") {
            layer.alert("请输入图片验证码!");
            return false;
        }
        $("#" + btn).html(SmsMethod.curCount + "s");
        $("#" + btn).addClass("disabled");
        $("#" + btn).attr("disabled", true);
        timer = setInterval("SmsMethod.SetRemainTime('" + btn + "')", 1000);
        $.ajax({
            type: "post",
            dataType: "json",
            url: '/home/sendsms',
            data: { phone: phone, code: txtCode },
            error: function () {
                $("#" + btn).removeAttr("disabled");
                $("#" + btn).html("获取手机验证码");
                layer.alert("请求失败");
            },
            success: function (data) {
                if (data != null) {
                    if (!data.Success) {
                        clearInterval(timer);
                        $("#" + btn).removeClass("disabled");
                        $("#" + btn).removeAttr("disabled");
                        $("#" + btn).html("获取手机验证码");
                        SmsMethod.curCount = SmsMethod.countCofig;
                    }
                    layer.alert(data.Msg);
                }
                else{
                    clearInterval(timer);
                    $("#" + btn).removeClass("disabled");
                    $("#" + btn).removeAttr("disabled");
                    $("#" + btn).html("获取手机验证码");
                    SmsMethod.curCount = SmsMethod.countCofig;
                    layer.alert("请求失败");
                }
            }
        });
    };
    SmsMethod.SetRemainTime = function(btn){
        if (SmsMethod.curCount == 0) {
            clearInterval(timer);
            $("#" + btn).removeAttr("disabled");
            $("#" + btn).removeClass("disabled");
            $("#" + btn).html("获取手机验证码");
            SmsMethod.curCount = SmsMethod.countCofig;
        }
        else {
            SmsMethod.curCount--;
            $("#" + btn).html(SmsMethod.curCount + "s");
        }
    }
</script>